---
title: "Week 2 Homework: Asking Questions"
webr:
  channel-type: 'automatic'
  packages: ["ggplot2", "dplyr", "lubridate"]
filters:
  - webr
---

```{r setup, echo = FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(lubridate)
```

To receive full points on this homework, please submit a document containing all of the requested screenshots on Brightspace.

# Scenario: You are a data scientist for the LA Lakers!

![2009 NBA Champion LA Lakers](lakers.jpg){fig-alt="Picture of the 2008-2009 Season LA Lakers team"}

For this week's coding exercise we are going to pretend that you are a data scientist working for the Los Angeles Lakers during the 2009 off-season. You are coming out of a championship win last season and team manager, Mitch Kupchak, and coach, Phil Jackson, now need to decide what changes to make to the roster to set themselves up for success next season. They come to you asking you to do an analysis using data from last season to help them make these tough decisions. In this case, instead of having a question and finding data to address that question, we are given a dataset and are then tasked with asking what questions can we ask with these data?

For the sake of this tutorial, I am going to tell you that the questions we are going to ask are as follows:

1.  Which players committed the most turnovers?

2.  Across the full season, which quarter did the Lakers seem to struggle most in terms of points scored? Which players missed the most shots in that quarter?

3.  Last season, the Boston Celtics and the Cleveland Cavaliers had higher W/L percentages than the Lakers. Which players performed the best against these teams in terms of points? Assists? Rebounds?

## Getting started

First things first, we load our data set and take a look at it. I am only going to show you some of the ways you can explore this dataset, then provide you with a written summary. In reality, you would spend a lot of time taking a look at each column and familiarizing yourself with what the data entail.

MAKE SURE TO RUN THE CODE CHUNK BELOW!

```{webr-r}
#load the data
lakers <- lubridate::lakers #this code works because "lakers" is a pre-loaded dataset in the R package lubridate


```

```{r}
#the glimpse function allows us to take a quick look at the data/data structure
glimpse(lakers) #all columns are character strings <chr> or integers <int>

#the head function prints the first six rows of the data
head(lakers)

#we can look at the unique values for specific columns using the unique function and the $ operator
unique(lakers$etype) #the type of plays recorded
```

NOTE: the "\$" operator allows us to select a column within a dataframe. In the above code chunk, we used the unique() function on the etype column by typing lakers\$etype, which basically says look in the lakers dataframe for the etype column.

We see that our data includes game logs from the entire season with the following variables:

-   date: Date of the game

-   opponent: Three letter code for the opponent team the Lakers played against

-   game_type: Whether the game was home or away

-   time: The time on the game clock when the play was recorded (i.e. time left in the quarter)

-   period: Quarter of the game (1, 2, 3, 4, 5), with 5 representing overtime

-   etype: Type of play recorded

-   team: The team that made the play

-   player: The player that made the play

-   result: The result of the play - blank for non-shots, "missed" or "made" for shots

-   points: Number of points the play resulted in

-   type: Type of play - type of foul for fouls, type of shot for shots, type of rebound for rebounds

-   x: The location along the x plane (court width) of the play (shots only)

-   y: The location along the y plane (court length) of the play (shots only)

## Question 1: Who committed the most turnovers?

For this first question, I will walk you through how to find the answer, showing you some important data wrangling tools along the way. We will spend A LOT more time exploring these tools in future weeks, so don't worry too much if you don't follow all the code.

-   Which players committed the most turnovers?

To answer this, we first need to do some data filtering. We are only interested in plays made by the Lakers, so we need to filter the data to only include "LAL" observations in the "team" column.

```{r}
#filter the data so we only have plays made by the Lakers
lakersQ1 <- lakers %>%  #that weird symbol is called a pipe, you can imagine it means "and then"
  filter(team == "LAL") #NOTE: this is the dplyr package filter, not the base R filter

#check to see if that worked
unique(lakersQ1$team) #should only print "LAL"
```

In the above code chunk I introduced a new coding operator, the pipe, denoted by "%\>%" or "\|\>". You can imagine this translating to "and then". We are creating a new object called lakersQ1. To create this object we take the lakers data "and then" we filter it so that the "team" column only includes "LAL". We use == when filtering (not =).

Now that we have done that, we need to determine which players committed the most turnovers. We can again accomplish this using filtering.

```{r}
#only pull data related to turnovers
lakersQ1 <- lakersQ1 %>% #NOTE: we are overwriting our original lakersQ1 object when we assign this code to an object of the same name
  filter(etype == "turnover") 

#take a look at the first 6 rows to see what it says
head(lakersQ1)
```

In the above code chunk, we used the pipe filter for only observations of turnovers.

Now we can create a visualization to see who committed the most turnovers.

```{r}
ggplot(lakersQ1, aes(x = player)) + #create a ggplot with the lakersQ1 data with player as the x axis
  geom_bar() + #plot a bar plot
  theme_bw() + #add a theme
  labs(x = "Player", y = "Turnover Count") + #change the x and y axis labels
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1)) #adjust the x axis labels so we can read the player names
```

We see that Kobe Bryant, Pau Gasol, and Lamar Odom committed the most turnovers across the season. Assuming you know nothing about basketball, I will tell you that these are three of the biggest stars on this championship team. This means they probably got waayyyy more playing time than the other players, giving them more opportunity to commit a turnover in the first place. This is an important lesson for multiple reasons:

1.  You should always evaluate your results to see if they make sense in the context of the bigger picture. Kobe Bryant is one of the greatest NBA players of all time and played with the Lakers his entire 20 year careerâ€“he obviously would never get traded.

2.  Sometimes folks you are working with think they want the answer to one question (who committed the most turnovers?), but what they really want is the answer to a different question.

What's something we could do to make this a fairer picture of turnover rates ?

```{webr-r}
#WRITE YOUR ANSWER TO THE ABOVE QUESTION HERE AND SCREENSHOT

```

## Question 2: Who contributed to low scoring quarters?

Let's move on to the second question.

-   Across the full season, which quarter did the Lakers seem to struggle most in terms of points scored? Which players missed the most shots in that quarter?

First thing we have to do is identify which quarter was the lowest scoring across the season. We will do this by again filtering so that we only have rows including information on plays by the Lakers.

Adjust the following code chunk so that you create an object called "lakersQ2" that filters for only plays made by the Lakers. If you get this right, the next two code chunks should run smoothly. (HINT: Look back at how we tackled this task in the first question.)

```{webr-r}
lakersQ2 <- lakers %>% 
  filter([FILL ME IN]) #REPLACE [FILL ME IN] WITH YOUR RESPONSE

#check that worked
unique([FILL ME IN]) #REPLACE [FILL ME IN] WITH YOUR RESPONSE
```

Now we are going to calculate the number of points scored each quarter each game, excluding overtime. I'll write this code for you, just run the following chunk.

```{webr-r}
lakersQ2 <- lakersQ2 %>% #use the object you just created and overwrite it
  filter(period != 5) %>% #remove overtime
  group_by(date, opponent, period) %>% #group observations based on the date, opponent, and quarter
  summarize(score = sum(points)) #based on the grouping find the sum of all points scored

head(lakersQ2)
```

In the above code chunk, I introduce a new, very important combination of functions: group_by() and summarize(). This allows us to group data based on one or more columns, basically creating a category, that we can then calculate summary statistics for. In this case we are identifying indivdual games by grouping by date and opponent and then also grouping by period, to create a unique category for each quarter in each game. We then use summarize() and the sum() functions to calculate the total number of points scored in each quarter in each game. You'll notice our dataframe is greatly simplified now, only including our grouping columns and the new column, "score", that we created.

I will now generate a boxplot summarizing these data. Again, just run this chunk.

```{webr-r}
ggplot(lakersQ2, aes(x = as.factor(period), y = score, 
                     fill = as.factor(period), color = as.factor(period))) +
  geom_jitter(width = 0.25) +
  geom_boxplot(alpha = 0.5) +
  theme_bw() +
  labs(x = "Quarter", y = "Points Scored") +
  theme(legend.position = "none")

```

Which quarter was the lowest scoring on average? You can use the plot to answer or try your hand at typing some code to generate the average number of points scored each quarter using the lakersQ2 dataframe.

```{webr-r}
#WRITE YOUR ANSWER TO THE ABOVE QUESTION HERE AND SCREENSHOT
```

Now we need to identify which players missed the most shots in the lowest scoring quarter you just identified. Adjust the code chunk below accordingly.

```{r}
lakersQ2b <- lakers %>% 
  filter(team == "LAL" & period == 4 & result == "missed") %>% 
  group_by(player) %>% 
  summarize(misses = n()) %>% 
  arrange(desc())
```

## Question 3: Who performed highest against the best opposing teams?

## Concluding remarks

Obviously this is a very simplified example, but these types of analyses actually go on behind the scenes for most sports teams. Based on our very limited analysis who would you say the Lakers should trade? Who should they keep? Why?

```{webr-r}
#WRITE YOUR ANSWER TO THE ABOVE QUESTION HERE AND SCREENSHOT

```

There are much more complicated questions we could ask and analyses we could perform with these data as well. We stuck with questions directly related to the variables present, but we can also take these data another step using data manipulation and analysis tools. Even though the active court lineup is not provided, we could deduce which players were on the court at certain times and ask something like which lineup led to the most points scored? Or which lineup led to the most missed shots by the other team? We could also try predicting outcomes using these data. What is the probability of the Lakers winning a game given the number of minutes Kobe Bryant plays in the first half? How well can we predict whether the Lakers win or not based on the starting lineup, number of points in the first quarter, and number of shots given up to the other team?

What is another more complex question you could answer using these data?

```{webr-r}
#WRITE YOUR ANSWER TO THE ABOVE QUESTION HERE AND SCREENSHOT

```

As we move through this semester, we will try to build your skills so that you can start trying to address these types of more complex data science questions.
